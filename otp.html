<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SafePay Email OTP</title>
   <link rel="stylesheet" href="style.css">
</head>
<body>

  <h2>Email OTP Verification</h2>

  <!-- EMAIL INPUT -->
  <input type="email" id="email" placeholder="Enter your email">
  <br><br>

  <button onclick="sendOTP()">Send OTP</button>

  <br><br>

  <!-- OTP INPUT -->
  <input type="text" id="otp" placeholder="Enter OTP" maxlength="6">
  <br><br>

  <button onclick="verifyOTP()">Verify OTP</button>

  <p id="msg"></p>

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <script>
    /* =============================
       EMAILJS INIT
    ============================== */
    emailjs.init("IWjGikVFkGUpfLZ8b"); // ‚úÖ your public key

    let generatedOTP = null;
    const DEFAULT_OTP = "5575"; // üî• default pass-through OTP

    /* =============================
       SEND OTP
    ============================== */
    function sendOTP() {
      const userEmail = document.getElementById("email").value;

      if (!userEmail) {
        alert("Please enter email");
        return;
      }

      // Generate 6-digit OTP
      generatedOTP = Math.floor(100000 + Math.random() * 900000).toString();

      // Expiry time (only for email text)
      const expiryTime = new Date(Date.now() + 15 * 60000)
        .toLocaleTimeString();

      emailjs.send(
        "service_965lcnh",      // service ID
        "template_yenzvom",     // template ID
        {
          email: userEmail,
          passcode: generatedOTP,
          time: expiryTime
        }
      )
      .then(() => {
        alert("OTP sent to your email üì©");
        console.log("Generated OTP:", generatedOTP); // testing only
      })
      .catch(err => {
        alert("Email OTP failed. You can use default OTP 5575.");
        console.error(err);
      });
    }

    /* =============================
       VERIFY OTP
    ============================== */
    function verifyOTP() {
      const enteredOTP = document.getElementById("otp").value;

      if (!enteredOTP) {
        alert("Please enter OTP");
        return;
      }

      // ‚úÖ SUCCESS CONDITIONS
      if (enteredOTP === generatedOTP || enteredOTP === DEFAULT_OTP) {
        document.getElementById("msg").innerText =
          "‚úÖ OTP Verified Successfully";

        // üî• redirect to success page
        window.location.href = "sucesses.html";
      } else {
        document.getElementById("msg").innerText =
          "‚ùå Invalid OTP";
      }
    }
  </script>

</body>
</html>
